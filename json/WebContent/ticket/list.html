<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script src="/json/js/AjaxUtil.js"></script>
</head>
<body>
<table border="1">
	<thead>
		<tr>
			<th>번호</th>
			<th>영화</th>
			<th>가격</th>
			<th>개봉일</th>
			<th>종료일</th>
			<th>등록일</th>
			<th>관객수</th>
		</tr>
	</thead>
	<tbody id="tbody">
	</tbody>
</table>
<div id="pagination"></div>
<script>
	var tbody = document.querySelector('#tbody');
	var pagination = document.querySelector('#pagination');
	var Request = function(){
		var params = {};
		var init = function(){
			var url = unescape(location.href);
			var paramList = url.substring(url.lastIndexOf('?')+1).split('&');
			for(var param of paramList){
				var kye = param.split('=')[0];
				var value = param.split('=')[1];
				params[kye] = value;
			}
		}
		
		this.getParameter = function(key){
			return params[key];
		}
		init();
	}
	var req = new Request();
	
	window.onload = function(){
		var params = {};
		var page = req.getParameter('page');
		var pi = {page:page?page:1};
		params = {pi:pi};
		var au = new AjaxUtil({url:'/json/api/ticket/list',
			cb:callback,
			params:params
			});
		au.send();
		function callback(res){
			res = JSON.parse(res);
			var html = '';
			if(res.list.length==0){
				html += '<tr><td colspan="7">등록된 영화가 없습니다.</td></tr>';
			}
			for(var tm of res.list){
				html += '<tr>';
				html += '<td>' + tm.tmnum + '</td>';
				html += '<td><a href="/json/ticket/view.jsp?tmnum=' + tm.tmnum + '">' + tm.tmname + '</a></td>';
				html += '<td>' + tm.tmprice + '</td>';
				html += '<td>' + tm.tmstartdat + '</td>';
				html += '<td>' + tm.tmenddat + '</td>';
				html += '<td>' + tm.tmcredat + '</td>';
				html += '<td>' + tm.tmcnt + '</td>';
				html += '</tr>';
			}
			tbody.insertAdjacentHTML('afterbegin',html)
			html = '';
			for(var i=res.page.sBlock,max=res.page.lBlock;i<=max;i++){
				html += '<a href="/json/ticket/list.html?page=' + i + '">';
				html += '[ ' + i + ' ]';
				html += '</a>';
			}
			pagination.insertAdjacentHTML('afterbegin',html)
		}
	}
</script>
</body>
</html>